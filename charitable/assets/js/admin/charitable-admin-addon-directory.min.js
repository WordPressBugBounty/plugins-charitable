(function($){"use strict";var s;var CharitableDirAdmin={settings:{iconActivate:"",iconDeactivate:"",iconInstall:"",iconSpinner:"Standby...",mediaFrame:false},init:function(){s=this.settings;$(CharitableDirAdmin.ready);$(document).on("CharitableDirReady",CharitableDirAdmin.initAddons)},ready:function(){$(document).trigger("CharitableDirReady");if($("#charitable-admin-addons-search").val()){$("#charitable-admin-addons-search").trigger("keyup")}},initAddons:function(){if(!$("#charitable-admin-addons").length){return}function setup_addon_sections(){function setCookie(name,value,days){var expires="";if(days){var date=new Date;date.setTime(date.getTime()+days*24*60*60*1e3);expires="; expires="+date.toUTCString()}document.cookie=name+"="+(value||"")+expires+"; path=/"}function getCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" ")c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length)}return null}var $collapsible_headers=$(".charitable-addons-section-header:not(.charitable-addons-section-header-featured)");var open_sections=getCookie("charitable_open_addon_sections");open_sections=open_sections?JSON.parse(open_sections):[];var featured_index=open_sections.indexOf("featured");if(featured_index>-1){open_sections.splice(featured_index,1);setCookie("charitable_open_addon_sections",JSON.stringify(open_sections),7)}$collapsible_headers.each((function(){var section_id=$(this).data("section");if(open_sections.includes(section_id)){$(this).addClass("open");$("#charitable-addons-"+section_id).show()}}));$collapsible_headers.on("click",(function(){var section_id=$(this).data("section");var content=$("#charitable-addons-"+section_id);var open_sections=getCookie("charitable_open_addon_sections");open_sections=open_sections?JSON.parse(open_sections):[];$(this).toggleClass("open");content.slideToggle();if($(this).hasClass("open")){if(!open_sections.includes(section_id)){open_sections.push(section_id)}}else{var index=open_sections.indexOf(section_id);if(index>-1){open_sections.splice(index,1)}}setCookie("charitable_open_addon_sections",JSON.stringify(open_sections),7)}))}setup_addon_sections();if($("#charitable-addons").length){$("#charitable-admin-addons-search").on("keyup search input",(function(){CharitableDirAdmin.updateAddonSearchResult(this)}));$("#charitable-admin-addons-search").on("input",(function(){var searchTerm=$(this).val();if(searchTerm){sessionStorage.setItem("charitable_addons_search",searchTerm)}else{sessionStorage.removeItem("charitable_addons_search")}}));var savedSearch=sessionStorage.getItem("charitable_addons_search");if(savedSearch){$("#charitable-admin-addons-search").val(savedSearch).trigger("keyup")}}$(document).on("click","#charitable-admin-addons .charitable-addons-list-item  button",(function(event){event.preventDefault();if($(this).hasClass("disabledd6")){return false}CharitableDirAdmin.addonToggle($(this))}))},updateAddonSearchResult:function(searchField){var searchTerm=$(searchField).val();searchTerm=searchTerm.replace(/[.,]/g," ");CharitableDirAdmin.performCustomSearch(searchTerm);CharitableDirAdmin.highlightSearchTerms(searchTerm)},performCustomSearch:function(searchTerm){var $allAddonItems=$("#charitable-addons .charitable-addons-list-item");var searchWords=searchTerm.toLowerCase().split(" ").filter((function(word){return word.length>0}));if(searchWords.length===0){$allAddonItems.show();$(".charitable-addons-section").show();return}var hasVisibleItems=false;$allAddonItems.each((function(){var $item=$(this);var $title=$item.find(".addon-link");var $description=$item.find(".addon-description");var titleText=$title.text().toLowerCase();var descriptionText=$description.text().toLowerCase();var matches=false;searchWords.forEach((function(word){if(titleText.indexOf(word)!==-1||descriptionText.indexOf(word)!==-1){matches=true}}));if(matches){$item.show();hasVisibleItems=true}else{$item.hide()}}));$(".charitable-addons-section").each((function(){var $section=$(this);var $visibleItems=$section.find(".charitable-addons-list-item:visible");if($visibleItems.length>0){$section.show();$section.find(".charitable-addons-section-content").show();$section.find(".charitable-addons-section-header").addClass("open")}else{$section.hide()}}))},highlightSearchTerms:function(searchTerm){if(!searchTerm){$(".addon-link, .addon-description").each((function(){var $element=$(this);$element.html($element.text())}));return}var searchWords=searchTerm.toLowerCase().split(" ").filter((function(word){return word.length>0}));if(searchWords.length===0){return}$(".charitable-addons-list-item:visible .addon-link, .charitable-addons-list-item:visible .addon-description").each((function(){var $element=$(this);var originalText=$element.text();var highlightedText=originalText;searchWords.forEach((function(word){if(word.length>0){var regex=new RegExp("("+word.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+")","gi");highlightedText=highlightedText.replace(regex,"<mark>$1</mark>")}}));if(highlightedText!==originalText){$element.html(highlightedText)}}))},setAddonState:function(plugin,state,pluginType,callback){var actions={activate:"charitable_activate_addon",install:"charitable_install_addon",deactivate:"charitable_deactivate_addon"},action=actions[state];if(!action){return}var data={action:action,nonce:charitable_admin.nonce,plugin:plugin,type:pluginType};$.post(charitable_admin.ajax_url,data,(function(res){callback(res)})).fail((function(xhr){console.log(xhr.responseText)}))},addonToggle:function($btn){if($btn.prop("disabled")||$btn.attr("data-plugin")==="invalid"){return}var $addon=$btn.closest(".addon-item"),plugin=$btn.attr("data-plugin"),pluginType=$btn.attr("data-type"),state,cssClass,stateText,buttonText,errorText,successText;if($btn.hasClass("status-go-to-url")){window.open($btn.attr("data-plugin"),"_blank");return}$btn.prop("disabled",true).addClass("loading");$btn.html(s.iconSpinner);if($btn.hasClass("status-active")){state="deactivate";cssClass="status-installed";if(pluginType==="plugin"||pluginType==="addon"){cssClass+=" button button-secondary"}stateText=charitable_admin.addon_inactive;buttonText=charitable_admin.addon_activate;errorText=charitable_admin.addon_deactivate;if(pluginType==="addon"){buttonText=s.iconActivate+buttonText;errorText=s.iconDeactivate+errorText}}else if($btn.hasClass("status-installed")){state="activate";cssClass="status-active";if(pluginType==="plugin"||pluginType==="addon"){cssClass+=" button"}stateText=charitable_admin.addon_active;buttonText=charitable_admin.addon_deactivate;if(pluginType==="addon"){buttonText=s.iconDeactivate+buttonText;errorText=s.iconActivate+charitable_admin.addon_activate}else if(pluginType==="plugin"){buttonText=charitable_admin.addon_activated;errorText=charitable_admin.addon_activate}}else if($btn.hasClass("status-missing")){state="install";cssClass="status-active";if(pluginType==="plugin"||pluginType==="addon"){cssClass+=" button disabled"}stateText=charitable_admin.addon_active;buttonText=charitable_admin.addon_activated;errorText=s.iconInstall;if(pluginType==="addon"){buttonText=s.iconActivate+charitable_admin.addon_deactivate;errorText+=charitable_admin.addon_install}}else{return}CharitableDirAdmin.setAddonState(plugin,state,pluginType,(function(res){if(res.success){if("install"===state){$btn.attr("data-plugin",res.data.basename);successText=res.data.msg;if(!res.data.is_activated){stateText=charitable_admin.addon_inactive;buttonText="addon"===pluginType?charitable_admin.addon_activate:s.iconActivate+charitable_admin.addon_activate;cssClass="addon"===pluginType?"status-installed button button-secondary":"status-installed"}else{cssClass="status-active button";stateText=charitable_admin.addon_active;buttonText=charitable_admin.addon_deactivate}}else{successText=res.data}$addon.find(".actions").append('<div class="msg success">'+successText+"</div>");$addon.find("span.status-label").removeClass("status-active status-installed status-missing").addClass(cssClass).removeClass("button button-primary button-secondary disabled").text(stateText);$btn.removeClass("status-active status-installed status-missing").removeClass("button button-primary button-secondary disabled").addClass(cssClass).html(buttonText)}else{if("object"===typeof res.data){if(pluginType==="addon"){$addon.find(".actions").append('<div class="msg error"><p>'+charitable_admin.addon_error+"</p></div>")}else{$addon.find(".actions").append('<div class="msg error"><p>'+charitable_admin.plugin_error+"</p></div>")}}else{if("string"===typeof res){var err_data=JSON.parse(res);if("string"===typeof err_data.error){$addon.find(".actions").append('<div class="msg error"><p>'+err_data.error+"</p></div>")}else{$addon.find(".actions").append('<div class="msg error"><p>There has been an error.</p></div>')}}}if("install"===state&&"addon"===pluginType){$btn.addClass("status-go-to-url").removeClass("status-missing")}$btn.html(errorText)}$btn.prop("disabled",false).removeClass("loading");if(!$addon.find(".actions").find(".msg.error").length){setTimeout((function(){$(".addon-item .msg").remove()}),3e3)}}))},getQueryString:function(name){var match=new RegExp("[?&]"+name+"=([^&]*)").exec(window.location.search);return match&&decodeURIComponent(match[1].replace(/\+/g," "))},debug:function(msg){if(CharitableDirAdmin.isDebug()){if(typeof msg==="object"||msg.constructor===Array){console.log("Charitable Debug:");console.log(msg)}else{console.log("Charitable Debug: "+msg)}}},isDebug:function(){return window.location.hash&&"#charitabledebug"===window.location.hash}};CharitableDirAdmin.init();window.CharitableDirAdmin=CharitableDirAdmin})(jQuery);