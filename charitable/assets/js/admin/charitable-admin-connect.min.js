"use strict";var CharitableConnect=window.CharitableConnect||function(document,window,$){var el={$connectBtn:$("#charitable-settings-connect-btn"),$connectKey:$("#charitable-settings-upgrade-license-key")};var app={init:function(){$(app.ready)},ready:function(){app.events()},events:function(){app.connectBtnClick()},connectBtnClick:function(){if(!el.$connectBtn.data("pro-connect")||el.$connectBtn.data("pro-connect")===false){return}el.$connectBtn.on("click",function(event){event.preventDefault();app.gotoUpgradeUrl()})},proAlreadyInstalled:function(res){var buttons={confirm:{text:charitable_admin.plugin_activate_btn,btnClass:"btn-confirm",keys:["enter"],action:function(){window.location.reload()}}};return{title:charitable_admin.almost_done,content:res.data.message,icon:"fa fa-check-circle",type:"green",buttons:buttons}},showActivateProPopup:function(data){var self=this;$.alert({title:charitable_admin.license_validated||charitable_admin.success,content:data.message,icon:"fa fa-check-circle",type:"green",boxWidth:"800px",buttons:{activate:{text:charitable_admin.activate_now,btnClass:"btn-confirm",keys:["enter"],action:function(){self.activateProThenRedirect(data)}},cancel:{text:charitable_admin.cancel,keys:["esc"]}}})},activateProThenRedirect:function(data){$.post(charitable_admin.ajax_url,{action:"charitable_activate_pro",nonce:charitable_admin.nonce,plugin_basename:data.plugin_basename||"charitable-pro/charitable.php"}).done(function(res){if(res.success&&res.data.redirect_url){window.location.href=res.data.redirect_url}else if(res.data&&res.data.message){$.alert({title:charitable_admin.oops,content:res.data.message,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:charitable_admin.ok,btnClass:"btn-confirm"}}})}}).fail(function(xhr){app.failAlert(xhr)})},showProAlreadyInstalledConfirm:function(data){$.alert({title:charitable_admin.success,content:data.message,icon:"fa fa-check-circle",type:"green",boxWidth:"800px",buttons:{activate:{text:charitable_admin.plugin_activate_btn,btnClass:"btn-confirm",keys:["enter"],action:function(){window.location.href=data.activate_url}},no:{text:charitable_admin.cancel,keys:["esc"],action:function(){window.location.href=data.general_url}}}})},gotoUpgradeUrl:function(event){var data={action:"charitable_connect_url",key:el.$connectKey.val(),nonce:charitable_admin.nonce};if(window.location.search.indexOf("charitable_connect_test=1")!==-1){data.charitable_connect_test="1"}if(!el.$connectKey.val()){$.alert({title:charitable_admin.oops,icon:"fa fa-exclamation-circle",type:"orange",boxWidth:"800px",content:charitable_admin.please_enter_key,buttons:{confirm:{text:charitable_admin.ok,btnClass:"btn-confirm",keys:["enter"]}}});event.preventDefault();return false}var $btn=el.$connectBtn;var originalHtml=$btn.html();var spinnerHtml='<i class="fa fa-spinner fa-spin" aria-hidden="true"></i> ';$btn.prop("disabled",true).html(spinnerHtml+charitable_admin.verifying);$.post(charitable_admin.ajax_url,data).done(function(res){if(res.success){if(res.data.show_activate_pro_popup){app.showActivateProPopup(res.data);return}if(res.data.upgrade_url){el.$connectBtn.data("charitable-skip-restore",true);window.location.href=res.data.upgrade_url;return}if(res.data.reload){$.alert(app.proAlreadyInstalled(res));return}if(res.data.action==="show_pro_download_confirmation"){app.showProDownloadConfirmation(res.data);return}if(res.data.pro_already_installed_confirm){app.showProAlreadyInstalledConfirm(res.data);return}if(res.data.show_manual_upgrade&&res.data.url){$.alert({title:charitable_admin.license_validated||charitable_admin.success,content:res.data.message,icon:"fa fa-check-circle",type:"green",boxWidth:"800px",buttons:{confirm:{text:charitable_admin.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){window.location.reload()}},manual:{text:charitable_admin.manual_install,btnClass:"btn-confirm",action:function(){window.open(res.data.url,"_blank");window.location.reload()}}}});return}}if(res.data&&res.data.show_manual_upgrade&&res.data.url){$.alert({title:charitable_admin.oops,content:res.data.message,icon:"fa fa-exclamation-circle",type:"orange",boxWidth:"800px",buttons:{confirm:{text:charitable_admin.ok,btnClass:"btn-confirm",keys:["enter"]},url:{text:charitable_admin.manual_install,btnClass:"btn-confirm",action:function(){window.open(res.data.url,"_blank")}}}})}else if(res.data&&res.data.message){$.alert({title:charitable_admin.oops,content:res.data.message,icon:"fa fa-exclamation-circle",type:"orange",boxWidth:"800px",buttons:{confirm:{text:charitable_admin.ok,btnClass:"btn-confirm",keys:["enter"]}}})}}).always(function(){var $b=el.$connectBtn;if($b.data("charitable-skip-restore")){$b.removeData("charitable-skip-restore");return}if(originalHtml){$b.prop("disabled",false).html(originalHtml)}else{$b.prop("disabled",false)}}).fail(function(xhr){app.failAlert(xhr)})},showProDownloadConfirmation:function(data){$.alert({title:data.confirmation_title||charitable_admin.license_validated,content:data.confirmation_text,icon:"fa fa-check-circle",type:"green",boxWidth:"800px",buttons:{download:{text:charitable_admin.download_pro,btnClass:"btn-confirm",keys:["enter"],action:function(){app.downloadProPlugin(data.pro_download_url)}},cancel:{text:charitable_admin.cancel,keys:["esc"]}}})},downloadProPlugin:function(downloadUrl){var data={action:"charitable_download_pro",download_url:downloadUrl,nonce:charitable_admin.nonce};$.alert({title:charitable_admin.downloading,content:charitable_admin.downloading_pro_message,icon:"fa fa-spinner fa-spin",type:"blue",boxWidth:"600px",buttons:false,closeIcon:false});$.post(charitable_admin.ajax_url,data).done(function(res){if(typeof jconfirm!=="undefined"&&jconfirm.instances&&jconfirm.instances.length>0){jconfirm.instances[jconfirm.instances.length-1].close()}if(res.success){if(res.data.action==="show_activation_confirmation"){app.showActivationConfirmation(res.data);return}}var errorMessage=res.data&&res.data.message?res.data.message:charitable_admin.download_failed;var addonsUrl=res.data&&res.data.addons_url?res.data.addons_url:null;var buttons={confirm:{text:charitable_admin.ok,btnClass:"btn-confirm",keys:["enter"]}};if(addonsUrl){buttons.addons={text:charitable_admin.visit_addons_page,btnClass:"btn-confirm",action:function(){window.location.href=addonsUrl}}}$.alert({title:charitable_admin.oops,content:errorMessage,icon:"fa fa-exclamation-circle",type:"orange",boxWidth:"800px",buttons:buttons})}).fail(function(xhr){if(typeof jconfirm!=="undefined"&&jconfirm.instances&&jconfirm.instances.length>0){jconfirm.instances[jconfirm.instances.length-1].close()}app.failAlert(xhr)})},showActivationConfirmation:function(data){$.alert({title:data.activation_title||charitable_admin.success,content:data.activation_text,icon:"fa fa-check-circle",type:"green",boxWidth:"800px",buttons:{activate:{text:charitable_admin.activate_now,btnClass:"btn-confirm",keys:["enter"],action:function(){app.activateProPlugin(data.plugin_basename)}},later:{text:charitable_admin.activate_later,keys:["esc"],action:function(){$.alert({title:charitable_admin.ready_to_use,content:charitable_admin.pro_ready_to_activate,icon:"fa fa-info-circle",type:"blue",boxWidth:"600px",buttons:{confirm:{text:charitable_admin.ok,btnClass:"btn-confirm",keys:["enter"]}}})}}}})},activateProPlugin:function(pluginBasename){var data={action:"charitable_activate_pro",plugin_basename:pluginBasename,nonce:charitable_admin.nonce};$.alert({title:charitable_admin.activating,content:charitable_admin.activating_pro_message,icon:"fa fa-spinner fa-spin",type:"blue",boxWidth:"600px",buttons:false,closeIcon:false});$.post(charitable_admin.ajax_url,data).done(function(res){if(typeof jconfirm!=="undefined"&&jconfirm.instances&&jconfirm.instances.length>0){jconfirm.instances[jconfirm.instances.length-1].close()}if(res.success&&res.data.reload){$.alert({title:charitable_admin.success,content:res.data.message,icon:"fa fa-check-circle",type:"green",boxWidth:"600px",buttons:{confirm:{text:charitable_admin.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){window.location.reload()}}}});return}var errorMessage=res.data&&res.data.message?res.data.message:charitable_admin.activation_failed;$.alert({title:charitable_admin.oops,content:errorMessage,icon:"fa fa-exclamation-circle",type:"orange",boxWidth:"800px",buttons:{confirm:{text:charitable_admin.ok,btnClass:"btn-confirm",keys:["enter"]}}})}).fail(function(xhr){if(typeof jconfirm!=="undefined"&&jconfirm.instances&&jconfirm.instances.length>0){jconfirm.instances[jconfirm.instances.length-1].close()}app.failAlert(xhr)})},failAlert:function(xhr){$.alert({title:charitable_admin.oops,content:charitable_admin.server_error+"<br>"+xhr.status+" "+xhr.statusText+" "+xhr.responseText,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:charitable_admin.ok,btnClass:"btn-confirm",keys:["enter"]}}})}};return app}(document,window,jQuery);CharitableConnect.init();