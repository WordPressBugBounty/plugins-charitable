const CharitableSystemInfo=window.CharitableSystemInfo||function(document,window,$){const app={init(){$(app.ready)},ready(){app.events()},events(){$(document).on("click","#charitable-system-information-copy",function(event){event.preventDefault();app.copySystemInformation()});$(document).on("click","#charitable-ssl-verify",function(event){event.preventDefault();app.verifySSLConnection()});$(document).on("click","#charitable-email-diagnostics",function(event){event.preventDefault();app.runEmailDiagnostics()});$(document).on("click","#charitable-send-test-email",function(event){event.preventDefault();app.sendTestEmail()});$(document).on("click","#charitable-email-diagnostics-copy",function(event){event.preventDefault();app.copyEmailDiagnostics()});$(document).on("click","#charitable-toggle-error-logs",function(event){event.preventDefault();app.toggleErrorLogs()});$(document).on("click","#charitable-clear-error-logs",function(event){event.preventDefault();app.clearErrorLogs()});$(document).on("click","#charitable-export-error-logs",function(event){event.preventDefault();app.exportErrorLogs()});$(document).on("click","#charitable-debug-log-scan",function(event){event.preventDefault();app.runDebugLogScan()});$(document).on("click",".charitable-format-tab",function(event){event.preventDefault();app.switchDebugFormat($(this))});$(document).on("click","#charitable-debug-copy",function(event){event.preventDefault();app.copyDebugResults()})},copySystemInformation(){$("#charitable-system-information").select();document.execCommand("copy")},verifySSLConnection(){const $btn=$("#charitable-ssl-verify");const btnLabel=$btn.text();const btnWidth=$btn.outerWidth();const $settings=$btn.parent();if(typeof charitable_admin_tools!=="undefined"&&typeof charitable_admin_tools.ajax_url!=="undefined"&&typeof charitable_admin_tools.nonce!=="undefined"&&typeof charitable_admin_tools.testing!=="undefined"){$btn.css("width",btnWidth).prop("disabled",true).text(charitable_admin_tools.testing);const data={action:"charitable_verify_ssl",nonce:charitable_admin_tools.nonce};$.post(charitable_admin_tools.ajax_url,data,function(res){if(typeof wpchar!=="undefined"){wpchar.debug(res)}$settings.find(".charitable-notice").remove();if(res.success){$btn.before('<div class="notice charitable-notice notice-success">'+res.data.msg+"</div>")}if(!res.success&&res.data.msg){$btn.before('<div class="notice charitable-notice notice-error">'+res.data.msg+"</div>")}if(!res.success&&res.data.debug){$btn.before('<div class="charitable-ssl-error pre-error">'+res.data.debug+"</div>")}$btn.css("width",btnWidth).prop("disabled",false).text(btnLabel)})}},runEmailDiagnostics(){const $btn=$("#charitable-email-diagnostics");const $results=$("#charitable-email-diagnostics-results");const $textarea=$results.find("textarea");const $copyBtn=$("#charitable-email-diagnostics-copy");const btnLabel=$btn.text();const btnWidth=$btn.outerWidth();if(typeof charitable_email_diagnostics!=="undefined"){$btn.css("width",btnWidth).prop("disabled",true).text(charitable_email_diagnostics.running_text);$results.show();$textarea.val("Running diagnostics, please wait...");$copyBtn.hide();$btn.parent().find(".charitable-notice").remove();const data={action:"charitable_email_diagnostics",nonce:charitable_email_diagnostics.nonce};$.post(charitable_email_diagnostics.ajax_url,data,function(response){if(typeof wpchar!=="undefined"){wpchar.debug(response)}if(response.success&&response.data.diagnostics){$textarea.val(response.data.diagnostics);$copyBtn.show();$btn.before('<div class="notice charitable-notice notice-success"><p>Email diagnostics completed successfully.</p></div>')}else{let errorMsg=charitable_email_diagnostics.error_text;if(response.data&&response.data.message){errorMsg=response.data.message}$textarea.val("### DIAGNOSTIC ERROR ###\n\n"+errorMsg);$btn.before('<div class="notice charitable-notice notice-error"><p>'+errorMsg+"</p></div>")}$btn.css("width",btnWidth).prop("disabled",false).text(btnLabel)}).fail(function(xhr,status,error){const errorMsg="AJAX request failed: "+status+" - "+error;$textarea.val("### DIAGNOSTIC ERROR ###\n\n"+errorMsg);$btn.before('<div class="notice charitable-notice notice-error"><p>Diagnostics request failed. Please try again.</p></div>');$btn.css("width",btnWidth).prop("disabled",false).text(btnLabel);if(typeof wpchar!=="undefined"){wpchar.debug({xhr:xhr,status:status,error:error})}})}else{$btn.before('<div class="notice charitable-notice notice-error"><p>Email diagnostics not properly loaded. Please refresh the page and try again.</p></div>')}},sendTestEmail(){const $btn=$("#charitable-send-test-email");const $messageDiv=$("#charitable-test-email-message");const $messageText=$("#charitable-test-email-message-text");const btnLabel=$btn.text();if(typeof charitable_email_diagnostics!=="undefined"){$btn.prop("disabled",true).text(charitable_email_diagnostics.sending_text||"Sending...");$messageDiv.hide();$btn.parent().find(".charitable-notice").not("#charitable-test-email-message .charitable-notice").remove();const data={action:"charitable_send_test_email",nonce:charitable_email_diagnostics.test_email_nonce};$.post(charitable_email_diagnostics.ajax_url,data,function(response){if(typeof wpchar!=="undefined"){wpchar.debug(response)}if(response.success&&response.data.success){$messageText.text(response.data.message);$messageDiv.find(".charitable-notice").removeClass("notice-error").addClass("notice-success");$messageDiv.show()}else{let errorMsg="Test email failed to send.";if(response.data&&response.data.message){errorMsg=response.data.message}$messageText.text(errorMsg);$messageDiv.find(".charitable-notice").removeClass("notice-success").addClass("notice-error");$messageDiv.show()}$btn.prop("disabled",false).text(btnLabel)}).fail(function(xhr,status,error){const errorMsg="Test email request failed. Please try again. If problems persist, contact support.";$messageText.text(errorMsg);$messageDiv.find(".charitable-notice").removeClass("notice-success").addClass("notice-error");$messageDiv.show();$btn.prop("disabled",false).text(btnLabel);if(typeof wpchar!=="undefined"){wpchar.debug({xhr:xhr,status:status,error:error})}})}else{$messageText.text("Test email functionality not properly loaded. Please refresh the page and try again.");$messageDiv.find(".charitable-notice").removeClass("notice-success").addClass("notice-error");$messageDiv.show()}},copyEmailDiagnostics(){const $textarea=$("#charitable-email-diagnostics-results textarea");if($textarea.length){$textarea.select();document.execCommand("copy");const $copyBtn=$("#charitable-email-diagnostics-copy");const originalText=$copyBtn.text();$copyBtn.text("Copied!");setTimeout(function(){$copyBtn.text(originalText)},2e3)}},toggleErrorLogs(){const $btn=$("#charitable-toggle-error-logs");const $container=$("#charitable-error-logs-container");if($container.is(":visible")){$container.hide();$btn.text("Show Error Logs")}else{$container.show();$btn.text("Hide Error Logs")}},clearErrorLogs(){const $btn=$("#charitable-clear-error-logs");const $messageDiv=$("#charitable-error-log-message");const $messageText=$("#charitable-error-log-message-text");const btnLabel=$btn.text();if(!confirm("Are you sure you want to clear all error logs? This action cannot be undone.")){return}if(typeof charitable_admin_tools!=="undefined"&&typeof charitable_admin_tools.ajax_url!=="undefined"&&typeof charitable_admin_tools.nonce!=="undefined"){$btn.prop("disabled",true).text("Clearing...");$messageDiv.hide();const data={action:"charitable_clear_error_logs",nonce:charitable_admin_tools.nonce};$.post(charitable_admin_tools.ajax_url,data,function(response){if(typeof wpchar!=="undefined"){wpchar.debug(response)}if(response.success){$messageText.text(response.data.message);$messageDiv.find(".charitable-notice").removeClass("notice-error").addClass("notice-success");$messageDiv.show();setTimeout(function(){location.reload()},2e3)}else{let errorMsg="Failed to clear error logs.";if(response.data&&response.data.message){errorMsg=response.data.message}$messageText.text(errorMsg);$messageDiv.find(".charitable-notice").removeClass("notice-success").addClass("notice-error");$messageDiv.show()}$btn.prop("disabled",false).text(btnLabel)}).fail(function(xhr,status,error){const errorMsg="Clear request failed. Please try again.";$messageText.text(errorMsg);$messageDiv.find(".charitable-notice").removeClass("notice-success").addClass("notice-error");$messageDiv.show();$btn.prop("disabled",false).text(btnLabel);if(typeof wpchar!=="undefined"){wpchar.debug({xhr:xhr,status:status,error:error})}})}else{alert("Error log clearing not properly loaded. Please refresh the page and try again.")}},exportErrorLogs(){const $btn=$("#charitable-export-error-logs");const $messageDiv=$("#charitable-error-log-message");const $messageText=$("#charitable-error-log-message-text");const btnLabel=$btn.text();if(typeof charitable_admin_tools!=="undefined"&&typeof charitable_admin_tools.ajax_url!=="undefined"&&typeof charitable_admin_tools.nonce!=="undefined"){$btn.prop("disabled",true).text("Exporting...");$messageDiv.hide();const data={action:"charitable_export_error_logs",nonce:charitable_admin_tools.nonce};$.post(charitable_admin_tools.ajax_url,data,function(response){if(typeof wpchar!=="undefined"){wpchar.debug(response)}if(response.success&&response.data.content){const csvContent=atob(response.data.content);const blob=new Blob([csvContent],{type:"text/csv;charset=utf-8;"});const link=document.createElement("a");if(link.download!==undefined){const url=URL.createObjectURL(blob);link.setAttribute("href",url);link.setAttribute("download",response.data.filename||"error-logs.csv");link.style.visibility="hidden";document.body.appendChild(link);link.click();document.body.removeChild(link)}$messageText.text(response.data.message);$messageDiv.find(".charitable-notice").removeClass("notice-error").addClass("notice-success");$messageDiv.show()}else{let errorMsg="Failed to export error logs.";if(response.data&&response.data.message){errorMsg=response.data.message}$messageText.text(errorMsg);$messageDiv.find(".charitable-notice").removeClass("notice-success").addClass("notice-error");$messageDiv.show()}$btn.prop("disabled",false).text(btnLabel)}).fail(function(xhr,status,error){const errorMsg="Export request failed. Please try again.";$messageText.text(errorMsg);$messageDiv.find(".charitable-notice").removeClass("notice-success").addClass("notice-error");$messageDiv.show();$btn.prop("disabled",false).text(btnLabel);if(typeof wpchar!=="undefined"){wpchar.debug({xhr:xhr,status:status,error:error})}})}else{alert("Error log export not properly loaded. Please refresh the page and try again.")}},runDebugLogScan(){const $btn=$("#charitable-debug-log-scan");const $results=$("#charitable-debug-log-results");const $messageDiv=$("#charitable-debug-log-message");const $messageText=$("#charitable-debug-log-message-text");const btnLabel=$btn.text();const btnWidth=$btn.outerWidth();if(typeof charitable_admin_tools!=="undefined"&&typeof charitable_admin_tools.ajax_url!=="undefined"&&typeof charitable_admin_tools.nonce!=="undefined"){$btn.css("width",btnWidth).prop("disabled",true).text("Scanning logs...");$results.show();$(".charitable-format-content").val("Scanning debug logs, please wait...");$messageDiv.hide();$btn.parent().find(".charitable-notice").remove();const data={action:"charitable_debug_log_scan",nonce:charitable_admin_tools.nonce};$.post(charitable_admin_tools.ajax_url,data,function(response){if(typeof wpchar!=="undefined"){wpchar.debug(response)}if(response.success&&response.data.scan_results){const results=response.data.scan_results;$("#charitable-debug-summary").val(results.summary||"No summary available.");$("#charitable-debug-technical").val(results.technical||"No technical details available.");$("#charitable-debug-forum").val(results.forum_ready||"No forum format available.");$messageText.text("Debug log scan completed successfully.");$messageDiv.find(".charitable-notice").removeClass("notice-error").addClass("notice-success");$messageDiv.show();app.switchDebugFormat($('.charitable-format-tab[data-format="summary"]'))}else{let errorMsg="Debug log scan failed.";let detailedMsg="";if(response.data&&response.data.message){errorMsg=response.data.message}if(response.data&&response.data.detailed_message){detailedMsg=response.data.detailed_message}const displayMsg=detailedMsg?detailedMsg:"### DEBUG LOG SCAN ERROR ###\n\n"+errorMsg;$(".charitable-format-content").val(displayMsg);$messageText.text(errorMsg);$messageDiv.find(".charitable-notice").removeClass("notice-success").addClass("notice-error");$messageDiv.show()}$btn.css("width",btnWidth).prop("disabled",false).text(btnLabel)}).fail(function(xhr,status,error){const errorMsg="Debug log scan request failed: "+status+" - "+error;$(".charitable-format-content").val("### DEBUG LOG SCAN ERROR ###\n\n"+errorMsg);$messageText.text("Scan request failed. Please try again.");$messageDiv.find(".charitable-notice").removeClass("notice-success").addClass("notice-error");$messageDiv.show();$btn.css("width",btnWidth).prop("disabled",false).text(btnLabel);if(typeof wpchar!=="undefined"){wpchar.debug({xhr:xhr,status:status,error:error})}})}else{alert("Debug log scanner not properly loaded. Please refresh the page and try again.")}},switchDebugFormat($clickedTab){const format=$clickedTab.data("format");$(".charitable-format-tab").removeClass("active");$clickedTab.addClass("active");$(".charitable-format-content").hide();$("#charitable-debug-"+format).show()},copyDebugResults(){const $activeContent=$(".charitable-format-content:visible");const $copyMessage=$("#charitable-debug-copy-message");if($activeContent.length>0){$activeContent.select();document.execCommand("copy");$copyMessage.fadeIn(200).delay(1500).fadeOut(200)}}};return app}(document,window,jQuery);CharitableSystemInfo.init();